<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Allowlist JSON Generator</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #1a1a1a; color: #ccc; max-width: 800px; margin: 0 auto; }
        .container { background: #222; padding: 20px; border-radius: 8px; border: 1px solid #333; }
        h2 { color: #0f0; margin-top: 0; }
        label { display: block; margin-top: 15px; font-weight: bold; color: #fff; }
        input, select, textarea { 
            width: 100%; padding: 10px; margin-top: 5px; 
            background: #000; color: #fff; border: 1px solid #444; 
            box-sizing: border-box; font-family: monospace;
        }
        textarea { height: 150px; }
        button { 
            margin-top: 20px; padding: 12px 20px; cursor: pointer; 
            background: #005500; color: white; border: 1px solid #0f0; 
            font-size: 16px; font-weight: bold; width: 100%;
        }
        button:hover { background: #007700; }
        #output { 
            margin-top: 20px; background: #111; padding: 15px; 
            border: 1px solid #555; color: #0ff; white-space: pre-wrap; 
        }
        .hint { font-size: 0.8em; color: #777; }
        .tip { color: #ff0; font-size: 0.9em; margin-top: 5px; display: block;}
    </style>
</head>
<body>
    <div class="container">
        <h2>üìù –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä JSON –¥–ª—è providers.json</h2>
        <p class="hint">–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç—Ç–æ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç, —á—Ç–æ–±—ã –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –¥–ª—è Pull Request.</p>
        
        <label>1. –ù–∞–∑–≤–∞–Ω–∏–µ –ü—Ä–æ–≤–∞–π–¥–µ—Ä–∞ / –ò—Å—Ç–æ—á–Ω–∏–∫:</label>
        <input type="text" id="provider" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: VK Cloud, Selectel, MyHomeNet...">
        
        <label>2. –°–ø–∏—Å–æ–∫ –ø–æ–¥—Å–µ—Ç–µ–π (CIDR):</label>
        <p class="hint">–í—Å—Ç–∞–≤—å—Ç–µ —Å–ø–∏—Å–æ–∫ IP –∏–ª–∏ –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤, –∫–∞–∂–¥—ã–π —Å –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏.</p>
        <span class="tip">üí° –°–æ–≤–µ—Ç: –ü–æ—Å—Ç–∞–≤—å—Ç–µ <b>*</b> –ø–µ—Ä–µ–¥ –ø–æ–¥—Å–µ—Ç—å—é, —á—Ç–æ–±—ã –ø–æ–º–µ—Ç–∏—Ç—å –µ—ë –∫–∞–∫ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—É—é (Priority 10).</span>
        <textarea id="cidrs" placeholder="10.20.30.0/24&#10;*192.168.1.0/24  &lt;-- –í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç&#10;172.16.0.0/12"></textarea>
        
        <label>3. –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (–¥–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö):</label>
        <select id="default_priority">
            <option value="1">1 - –ù–∏–∑–∫–∏–π (–†–µ–¥–∫–æ)</option>
            <option value="5" selected>5 - –û–±—ã—á–Ω—ã–π (–°—Ç–∞–Ω–¥–∞—Ä—Ç)</option>
        </select>
        
        <label>4. –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (–¥–ª—è –∞–¥–º–∏–Ω–∞):</label>
        <input type="text" id="comment" placeholder="–û—Ç–∫—É–¥–∞ —ç—Ç–æ—Ç —Å–ø–∏—Å–æ–∫? (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)">
        
        <button onclick="generateJSON()">‚öôÔ∏è –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å JSON</button>
        
        <label>–†–µ–∑—É–ª—å—Ç–∞—Ç (–ö–æ–ø–∏—Ä—É–π—Ç–µ –∏ –≤—Å—Ç–∞–≤–ª—è–π—Ç–µ –≤ providers.json):</label>
        <textarea id="output" readonly></textarea>
        <button onclick="copyToClipboard()" style="background: #333; border-color: #666; margin-top: 5px;">üìã –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤ –±—É—Ñ–µ—Ä</button>
    </div>

    <script>
        function generateJSON() {
            const provider = document.getElementById('provider').value.trim();
            const rawCidrs = document.getElementById('cidrs').value;
            const defaultPriority = parseInt(document.getElementById('default_priority').value);
            const comment = document.getElementById('comment').value.trim();

            if (!provider) { alert("–£–∫–∞–∂–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞!"); return; }
            if (!rawCidrs) { alert("–°–ø–∏—Å–æ–∫ –ø–æ–¥—Å–µ—Ç–µ–π –ø—É—Å—Ç!"); return; }

            const lines = rawCidrs.split('\n');
            const result = [];

            lines.forEach(line => {
                let cleanLine = line.trim();
                if (!cleanLine) return; 

                let priority = defaultPriority;
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ * (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
                if (cleanLine.startsWith('*') || cleanLine.endsWith('*')) {
                    priority = 10;
                    cleanLine = cleanLine.replace(/\*/g, '').trim();
                }
                
                // –û—á–∏—Å—Ç–∫–∞ –æ—Ç –º—É—Å–æ—Ä–∞ (–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –ø–æ—Å–ª–µ # –∏–ª–∏ –ø—Ä–æ–±–µ–ª–∞, –µ—Å–ª–∏ CIDR –≤ –Ω–∞—á–∞–ª–µ)
                // –ü—Ä–æ—Å—Ç–µ–π—à–∞—è —ç–≤—Ä–∏—Å—Ç–∏–∫–∞: –±–µ—Ä–µ–º –ø–µ—Ä–≤–æ–µ —Å–ª–æ–≤–æ
                const parts = cleanLine.split(/[\s#]+/);
                let cidr = parts[0];

                const entry = {
                    provider: provider,
                    cidr: cidr,
                    priority: priority
                };
                if (comment) entry.comment = comment;
                
                result.push(entry);
            });

            // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞: –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ (10) —Å–≤–µ—Ä—Ö—É
            result.sort((a, b) => b.priority - a.priority);

            const jsonStr = JSON.stringify(result, null, 2);
            document.getElementById('output').value = jsonStr;
        }

        function copyToClipboard() {
            const copyText = document.getElementById("output");
            copyText.select();
            document.execCommand("copy");
            alert("JSON —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω! –¢–µ–ø–µ—Ä—å –¥–æ–±–∞–≤—å—Ç–µ –µ–≥–æ –≤ –º–∞—Å—Å–∏–≤ —Ñ–∞–π–ª–∞ providers.json");
        }
    </script>
</body>
</html>